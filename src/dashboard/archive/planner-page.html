<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMind Project Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d47a1 0%, #1976d2 50%, #42a5f5 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .planner-dashboard {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 50%, #2196f3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 25px;
            height: calc(100vh - 150px);
        }

        /* Left Panel - Project Templates */
        .templates-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow-y: auto;
        }

        .panel-title {
            font-size: 1.3em;
            color: #64b5f6;
            margin-bottom: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .template-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #64b5f6;
        }

        .template-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.2);
        }

        .template-item.selected {
            background: rgba(100, 181, 246, 0.2);
            border-left-color: #64b5f6;
        }

        .template-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .template-description {
            font-size: 0.85em;
            opacity: 0.8;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .template-tech {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tech-tag {
            background: rgba(100, 181, 246, 0.3);
            color: #64b5f6;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 500;
        }

        /* Center Panel - Planning Interface */
        .planning-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .planning-header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .planning-title {
            font-size: 1.4em;
            font-weight: bold;
        }

        .phase-indicator {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .phase-step {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .phase-step.active {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            opacity: 1;
            color: white;
        }

        .phase-step.completed {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
            opacity: 0.8;
        }

        .planning-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            max-height: 400px;
            padding-right: 10px;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .user-avatar {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
        }

        .ai-avatar {
            background: linear-gradient(135deg, #7c4dff, #3f51b5);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px 20px;
            max-width: 70%;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(66, 165, 245, 0.2));
        }

        .message-time {
            font-size: 0.7em;
            opacity: 0.6;
            margin-top: 8px;
        }

        .input-area {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            color: #ffffff;
            font-size: 0.95em;
            resize: none;
            min-height: 50px;
            max-height: 120px;
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-btn {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Project Form */
        .project-form {
            display: none;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .section-header {
            font-size: 1.1em;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #64b5f6;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.1);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Right Panel - Project Overview */
        .overview-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow-y: auto;
        }

        .overview-section {
            margin-bottom: 25px;
        }

        .overview-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 3px solid #64b5f6;
        }

        .overview-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .overview-value {
            font-size: 0.95em;
            font-weight: 500;
        }

        .progress-indicator {
            background: rgba(0, 0, 0, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #64b5f6, #42a5f5);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px 5px 5px 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #64b5f6;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="planner-dashboard">
        <div class="header">
            <h1>üéØ CodeMind Project Planner</h1>
            <p>AI-powered project planning, discussion, and architecture design system</p>
        </div>

        <div class="main-layout">
            <!-- Left Panel - Project Templates -->
            <div class="templates-panel">
                <div class="panel-title">
                    üìã Project Templates
                </div>
                
                <div id="templatesList">
                    <!-- Templates will be loaded dynamically -->
                </div>

                <button class="btn btn-secondary" onclick="createCustomProject()" style="width: 100%; margin-top: 20px;">
                    ‚ö° Custom Project
                </button>
            </div>

            <!-- Center Panel - Planning Interface -->
            <div class="planning-area">
                <div class="planning-header">
                    <div class="planning-title" id="planningTitle">Project Planning Session</div>
                    <div class="phase-indicator">
                        <div class="phase-step active" id="phase1">üí≠ Discussion</div>
                        <div class="phase-step" id="phase2">üìã Planning</div>
                        <div class="phase-step" id="phase3">üèóÔ∏è Architecture</div>
                        <div class="phase-step" id="phase4">üöÄ Launch</div>
                    </div>
                </div>
                
                <div class="planning-content">
                    <!-- Chat Interface -->
                    <div class="chat-container" id="chatInterface">
                        <div class="messages-area" id="messagesArea">
                            <div class="message">
                                <div class="message-avatar ai-avatar">ü§ñ</div>
                                <div class="message-content">
                                    <div>Hello! I'm your AI project planning assistant. I'll help you create a comprehensive plan for your new project. Let's start by discussing your ideas!</div>
                                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-area">
                            <textarea class="message-input" id="messageInput" 
                                    placeholder="Describe your project idea, requirements, or ask me anything..."
                                    rows="2"></textarea>
                            <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                                <span>Send</span> üí¨
                            </button>
                        </div>
                    </div>

                    <!-- Project Form (Hidden initially) -->
                    <div class="project-form" id="projectForm">
                        <div class="form-section">
                            <div class="section-header">
                                üìù Basic Information
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Project Name</label>
                                    <input type="text" class="form-input" id="projectName" placeholder="My Awesome Project">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Project Type</label>
                                    <select class="form-select" id="projectType">
                                        <option value="">Select type...</option>
                                        <option value="web-app">Web Application</option>
                                        <option value="mobile-app">Mobile App</option>
                                        <option value="desktop-app">Desktop Application</option>
                                        <option value="api">API/Backend Service</option>
                                        <option value="library">Library/Framework</option>
                                        <option value="cli-tool">CLI Tool</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">Project Description</label>
                                <textarea class="form-textarea" id="projectDescription" 
                                        placeholder="Brief description of what your project does..."></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="section-header">
                                üõ†Ô∏è Technical Stack
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Primary Language</label>
                                    <select class="form-select" id="primaryLanguage">
                                        <option value="">Select language...</option>
                                        <option value="javascript">JavaScript</option>
                                        <option value="typescript">TypeScript</option>
                                        <option value="python">Python</option>
                                        <option value="java">Java</option>
                                        <option value="csharp">C#</option>
                                        <option value="cpp">C++</option>
                                        <option value="rust">Rust</option>
                                        <option value="go">Go</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Framework</label>
                                    <input type="text" class="form-input" id="framework" placeholder="React, Vue, Django, etc.">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Database</label>
                                    <select class="form-select" id="database">
                                        <option value="">Select database...</option>
                                        <option value="postgresql">PostgreSQL</option>
                                        <option value="mysql">MySQL</option>
                                        <option value="mongodb">MongoDB</option>
                                        <option value="sqlite">SQLite</option>
                                        <option value="redis">Redis</option>
                                        <option value="none">No Database</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Deployment Platform</label>
                                    <select class="form-select" id="deployment">
                                        <option value="">Select platform...</option>
                                        <option value="docker">Docker</option>
                                        <option value="aws">AWS</option>
                                        <option value="azure">Azure</option>
                                        <option value="gcp">Google Cloud</option>
                                        <option value="vercel">Vercel</option>
                                        <option value="netlify">Netlify</option>
                                        <option value="heroku">Heroku</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="section-header">
                                üìÅ Project Structure
                            </div>
                            <div class="form-group">
                                <label class="form-label">Project Path</label>
                                <input type="text" class="form-input" id="projectPath" 
                                       placeholder="C:\workspace\my-project">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Initial Features</label>
                                <textarea class="form-textarea" id="initialFeatures" 
                                        placeholder="List the key features you want to implement first..."
                                        rows="4"></textarea>
                            </div>
                        </div>

                        <div class="quick-actions">
                            <button class="btn btn-success" onclick="finalizeProject()">
                                üöÄ Create Project & Start Workflow
                            </button>
                            <button class="btn btn-secondary" onclick="backToDiscussion()">
                                ‚Üê Back to Discussion
                            </button>
                            <button class="btn btn-secondary" onclick="saveAsDraft()">
                                üíæ Save as Draft
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Project Overview -->
            <div class="overview-panel">
                <div class="panel-title">
                    üìä Project Overview
                </div>

                <div class="overview-section">
                    <div class="section-header">Planning Progress</div>
                    <div class="progress-indicator">
                        <div class="progress-bar" id="planningProgress" style="width: 25%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 8px; font-size: 0.8em; opacity: 0.7;">
                        25% Complete
                    </div>
                </div>

                <div class="overview-section" id="projectSummary">
                    <div class="section-header">Current Discussion</div>
                    <div class="overview-item">
                        <div class="overview-label">Status</div>
                        <div class="overview-value">Gathering Requirements</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">Messages</div>
                        <div class="overview-value" id="messageCount">1</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">Estimated Duration</div>
                        <div class="overview-value">15-30 minutes</div>
                    </div>
                </div>

                <div class="overview-section" id="keyDecisions" style="display: none;">
                    <div class="section-header">Key Decisions</div>
                    <!-- Decisions will be populated dynamically -->
                </div>

                <div class="overview-section" id="nextSteps">
                    <div class="section-header">Next Steps</div>
                    <div class="overview-item">
                        <div class="overview-value">üí≠ Discuss project requirements and goals</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-value">üéØ Define core features and functionality</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-value">üèóÔ∏è Plan technical architecture</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn btn-secondary" onclick="exportPlan()">
                        üìÑ Export Plan
                    </button>
                    <button class="btn btn-secondary" onclick="shareSession()">
                        üîó Share Session
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentPhase = 1;
        let messages = [];
        let projectData = {};
        let sessionId = 'session_' + Date.now();
        let isTyping = false;
        let selectedTemplate = null;

        // Initialize planner
        document.addEventListener('DOMContentLoaded', function() {
            loadProjectTemplates();
            setupEventListeners();
            
            // Add initial AI message to messages array
            messages.push({
                type: 'ai',
                content: "Hello! I'm your AI project planning assistant. I'll help you create a comprehensive plan for your new project. Let's start by discussing your ideas!",
                timestamp: new Date()
            });
        });

        function setupEventListeners() {
            // Enter key to send message
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            document.getElementById('messageInput').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        async function loadProjectTemplates() {
            const templates = [
                {
                    id: 'web-app-react',
                    name: 'React Web App',
                    description: 'Modern web application with React, TypeScript, and Node.js backend',
                    technologies: ['React', 'TypeScript', 'Node.js', 'PostgreSQL']
                },
                {
                    id: 'mobile-react-native',
                    name: 'React Native App',
                    description: 'Cross-platform mobile application for iOS and Android',
                    technologies: ['React Native', 'TypeScript', 'Expo', 'Firebase']
                },
                {
                    id: 'api-fastapi',
                    name: 'FastAPI Backend',
                    description: 'High-performance API service with Python FastAPI',
                    technologies: ['Python', 'FastAPI', 'PostgreSQL', 'Redis']
                },
                {
                    id: 'desktop-electron',
                    name: 'Electron Desktop App',
                    description: 'Cross-platform desktop application with web technologies',
                    technologies: ['Electron', 'TypeScript', 'React', 'SQLite']
                },
                {
                    id: 'microservice-go',
                    name: 'Go Microservice',
                    description: 'Scalable microservice architecture with Go',
                    technologies: ['Go', 'Docker', 'Kubernetes', 'gRPC']
                },
                {
                    id: 'ml-python',
                    name: 'ML/AI Project',
                    description: 'Machine learning project with Python and popular ML libraries',
                    technologies: ['Python', 'TensorFlow', 'PyTorch', 'Jupyter']
                }
            ];

            displayTemplates(templates);
        }

        function displayTemplates(templates) {
            const container = document.getElementById('templatesList');
            
            container.innerHTML = templates.map(template => `
                <div class="template-item" onclick="selectTemplate('${template.id}', '${template.name}')">
                    <div class="template-name">${template.name}</div>
                    <div class="template-description">${template.description}</div>
                    <div class="template-tech">
                        ${template.technologies.map(tech => 
                            `<span class="tech-tag">${tech}</span>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        async function selectTemplate(templateId, templateName) {
            // Update UI
            document.querySelectorAll('.template-item').forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            selectedTemplate = templateId;
            
            // Send AI message about template selection
            await simulateAIResponse(`Great choice! I see you're interested in a ${templateName}. Let me ask you a few questions to customize this template for your specific needs:

1. What's the main purpose or problem your project will solve?
2. Who is your target audience?
3. Do you have any specific requirements or constraints?

Feel free to share as much detail as you'd like!`);
            
            updateOverview();
        }

        function createCustomProject() {
            document.querySelectorAll('.template-item').forEach(item => item.classList.remove('selected'));
            selectedTemplate = null;
            
            simulateAIResponse(`Perfect! Let's create a custom project tailored specifically to your needs. I'll guide you through the process step by step.

To get started, could you tell me:
1. What type of project are you building?
2. What problem are you trying to solve?
3. What technologies are you most comfortable with?

Don't worry if you're not sure about everything yet - we'll figure it out together!`);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            
            if (!content || isTyping) return;
            
            // Add user message
            addMessage('user', content);
            input.value = '';
            input.style.height = 'auto';
            
            // Update message count
            document.getElementById('messageCount').textContent = messages.length;
            
            // Show typing indicator and simulate AI response
            showTypingIndicator();
            
            setTimeout(async () => {
                hideTypingIndicator();
                await processUserMessage(content);
                updateOverview();
            }, 1500 + Math.random() * 2000);
        }

        function addMessage(type, content) {
            const message = {
                type,
                content,
                timestamp: new Date()
            };
            
            messages.push(message);
            
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = type === 'user' ? 'üë§' : 'ü§ñ';
            const avatarClass = type === 'user' ? 'user-avatar' : 'ai-avatar';
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${avatarClass}">${avatar}</div>
                <div class="message-content">
                    <div>${content}</div>
                    <div class="message-time">${message.timestamp.toLocaleTimeString()}</div>
                </div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function showTypingIndicator() {
            isTyping = true;
            const messagesArea = document.getElementById('messagesArea');
            
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar ai-avatar">ü§ñ</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            messagesArea.appendChild(typingDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function hideTypingIndicator() {
            isTyping = false;
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function processUserMessage(content) {
            // Simple AI response logic based on content analysis
            let response = '';
            
            if (messages.length <= 3) {
                // Early conversation - gathering requirements
                response = await generateRequirementsResponse(content);
            } else if (messages.length <= 8) {
                // Mid conversation - technical planning
                response = await generateTechnicalResponse(content);
                if (messages.length === 6) {
                    setTimeout(() => advanceToPhase(2), 2000);
                }
            } else {
                // Later conversation - finalization
                response = await generateFinalizationResponse(content);
                if (messages.length === 10) {
                    setTimeout(() => advanceToPhase(3), 2000);
                }
            }
            
            addMessage('ai', response);
        }

        async function generateRequirementsResponse(userInput) {
            const responses = [
                `That sounds like an interesting project! Based on what you've described, I can see several key areas we should focus on. Let me dig deeper:

What specific features do you consider most important for the initial version? Also, do you have any existing systems or APIs you need to integrate with?`,

                `Excellent! I'm getting a clearer picture of your project. A few more questions to help me provide better guidance:

1. What's your timeline for this project?
2. Will you be working alone or with a team?
3. Do you have any budget constraints for tools or services?`,

                `Perfect! Now I have a good understanding of your requirements. Based on our discussion, I'm starting to see the technical architecture taking shape. 

Let me suggest a few approaches and get your thoughts on the technical direction you'd prefer to take.`
            ];
            
            return responses[Math.min(messages.filter(m => m.type === 'user').length - 1, responses.length - 1)];
        }

        async function generateTechnicalResponse(userInput) {
            const responses = [
                `Great choices! Based on your requirements, I'm recommending a layered architecture that will scale well with your needs. Here's what I'm thinking:

üèóÔ∏è **Recommended Architecture:**
- Frontend: Modern web framework with responsive design
- Backend: RESTful API with proper authentication
- Database: Relational database for data consistency
- Deployment: Containerized with CI/CD pipeline

Does this align with your technical preferences? Any specific technologies you'd like to use or avoid?`,

                `Excellent! I can see you have a clear vision for the technical implementation. Let me outline a development roadmap that breaks this down into manageable phases:

üìã **Development Phases:**
1. **Foundation** - Set up project structure, basic authentication
2. **Core Features** - Implement main functionality 
3. **Integration** - Connect external services, testing
4. **Launch** - Deployment, monitoring, documentation

Would you like me to create detailed user stories and technical specifications for each phase?`,

                `Perfect! I think we have all the information we need to create a comprehensive project plan. Let me transition us to the formal planning phase where we'll document everything we've discussed.

This will include your business plan, technical roadmap, architecture diagrams, and a complete project setup. Ready to proceed?`
            ];
            
            return responses[Math.min(messages.filter(m => m.type === 'user').length - 4, responses.length - 1)];
        }

        async function generateFinalizationResponse(userInput) {
            return `Fantastic! I'll now compile everything we've discussed into a comprehensive project plan. This will include:

‚úÖ **Business Plan** - Goals, target audience, success metrics
‚úÖ **Technical Architecture** - System design, technology stack, infrastructure
‚úÖ **Development Roadmap** - Phases, milestones, timelines
‚úÖ **Project Setup** - Repository structure, development environment

I'll also create a workflow in the orchestrator and initialize your project in the system. This should take just a moment...

Would you like to proceed with the project creation?`;
        }

        async function simulateAIResponse(content) {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('ai', content);
                updateOverview();
            }, 1500 + Math.random() * 1500);
        }

        function advanceToPhase(phaseNumber) {
            // Update phase indicators
            document.querySelectorAll('.phase-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < phaseNumber) {
                    step.classList.add('completed');
                } else if (index + 1 === phaseNumber) {
                    step.classList.add('active');
                }
            });
            
            currentPhase = phaseNumber;
            
            // Update progress
            const progress = (phaseNumber / 4) * 100;
            document.getElementById('planningProgress').style.width = progress + '%';
            document.querySelector('.progress-indicator').nextElementSibling.textContent = `${progress}% Complete`;
            
            // Show project form at phase 2
            if (phaseNumber >= 2) {
                setTimeout(() => {
                    document.getElementById('chatInterface').style.display = 'none';
                    document.getElementById('projectForm').style.display = 'block';
                    populateFormFromDiscussion();
                }, 2000);
            }
        }

        function populateFormFromDiscussion() {
            // Analyze messages and populate form fields
            // This is a simplified version - in reality, would use NLP
            const allMessages = messages.map(m => m.content).join(' ').toLowerCase();
            
            if (selectedTemplate) {
                // Populate based on selected template
                const templateMappings = {
                    'web-app-react': {
                        projectType: 'web-app',
                        primaryLanguage: 'typescript',
                        framework: 'React'
                    },
                    'mobile-react-native': {
                        projectType: 'mobile-app',
                        primaryLanguage: 'typescript',
                        framework: 'React Native'
                    },
                    'api-fastapi': {
                        projectType: 'api',
                        primaryLanguage: 'python',
                        framework: 'FastAPI'
                    }
                };
                
                const mapping = templateMappings[selectedTemplate];
                if (mapping) {
                    Object.entries(mapping).forEach(([key, value]) => {
                        const element = document.getElementById(key);
                        if (element) element.value = value;
                    });
                }
            }
            
            // Set default project path
            document.getElementById('projectPath').value = 'C:\\workspace\\new-project';
        }

        function backToDiscussion() {
            document.getElementById('projectForm').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';
        }

        async function finalizeProject() {
            // Collect form data
            projectData = {
                name: document.getElementById('projectName').value,
                type: document.getElementById('projectType').value,
                description: document.getElementById('projectDescription').value,
                primaryLanguage: document.getElementById('primaryLanguage').value,
                framework: document.getElementById('framework').value,
                database: document.getElementById('database').value,
                deployment: document.getElementById('deployment').value,
                projectPath: document.getElementById('projectPath').value,
                initialFeatures: document.getElementById('initialFeatures').value,
                template: selectedTemplate,
                messages: messages,
                sessionId: sessionId
            };
            
            // Save to database and create project
            try {
                const response = await fetch('/api/dashboard/planner/projects', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Create workflow in orchestrator
                    await createProjectWorkflow(result.projectId);
                    
                    // Advance to final phase
                    advanceToPhase(4);
                    
                    // Redirect to project view
                    setTimeout(() => {
                        window.location.href = `/dashboard/project-view.html?project=${result.projectId}`;
                    }, 3000);
                    
                    alert('Project created successfully! Starting workflow and redirecting to project view...');
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project. Please try again.');
            }
        }

        async function createProjectWorkflow(projectId) {
            const workflowData = {
                name: `${projectData.name} - Development Workflow`,
                description: `Automated development workflow for ${projectData.name}`,
                type: 'sequential',
                projectPath: projectData.projectPath,
                projectId: projectId,
                nodes: [
                    {
                        id: 'setup',
                        name: 'Project Setup',
                        type: 'initialization',
                        description: 'Initialize project structure and dependencies'
                    },
                    {
                        id: 'development',
                        name: 'Core Development',
                        type: 'coding',
                        description: 'Implement core features and functionality'
                    },
                    {
                        id: 'testing',
                        name: 'Testing & QA',
                        type: 'validation',
                        description: 'Run tests and quality assurance checks'
                    },
                    {
                        id: 'deployment',
                        name: 'Deployment',
                        type: 'deployment',
                        description: 'Deploy to production environment'
                    }
                ]
            };
            
            try {
                await fetch('/api/dashboard/orchestrator/workflows', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(workflowData)
                });
            } catch (error) {
                console.error('Error creating workflow:', error);
            }
        }

        function saveAsDraft() {
            const draft = {
                ...projectData,
                status: 'draft',
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem(`project_draft_${sessionId}`, JSON.stringify(draft));
            alert('Project saved as draft!');
        }

        function updateOverview() {
            const userMessages = messages.filter(m => m.type === 'user').length;
            const aiMessages = messages.filter(m => m.type === 'ai').length;
            
            document.getElementById('messageCount').textContent = messages.length;
            
            // Update next steps based on progress
            const nextStepsContainer = document.getElementById('nextSteps');
            let nextSteps = [];
            
            if (currentPhase === 1) {
                nextSteps = [
                    'üí≠ Continue discussing project requirements',
                    'üéØ Define core features and functionality',
                    'üèóÔ∏è Plan technical architecture'
                ];
            } else if (currentPhase === 2) {
                nextSteps = [
                    'üìù Complete project details form',
                    '‚öôÔ∏è Configure technical specifications',
                    'üöÄ Finalize and create project'
                ];
            } else if (currentPhase >= 3) {
                nextSteps = [
                    '‚úÖ Project planning completed',
                    'üîß Workflow creation in progress',
                    'üìä Redirecting to project dashboard'
                ];
            }
            
            nextStepsContainer.innerHTML = `
                <div class="section-header">Next Steps</div>
                ${nextSteps.map(step => `
                    <div class="overview-item">
                        <div class="overview-value">${step}</div>
                    </div>
                `).join('')}
            `;
        }

        function exportPlan() {
            const plan = {
                sessionId,
                projectData,
                messages,
                phase: currentPhase,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(plan, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `project_plan_${sessionId}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function shareSession() {
            const shareUrl = `${window.location.origin}/dashboard/planner-page.html?session=${sessionId}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert('Session URL copied to clipboard!');
            }).catch(() => {
                prompt('Copy this URL to share the session:', shareUrl);
            });
        }
    </script>
</body>
</html>