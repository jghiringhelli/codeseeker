<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMind Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 10px;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h3 {
            margin-bottom: 15px;
            color: #8b5cf6;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #10b981;
            display: block;
        }

        .status-label {
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        .project-selector {
            margin-bottom: 20px;
        }

        .project-selector select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .query-section {
            margin-bottom: 30px;
        }

        .query-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .query-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .query-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .results-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-auto;
            max-height: 400px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.5);
        }

        .error {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .connection-status {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .db-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .db-status.connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .db-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .refresh-btn {
            float: right;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† CodeMind Dashboard</h1>
            <p>Simple project status and database queries</p>
        </div>

        <!-- Connection Status -->
        <div class="connection-status">
            <div class="db-status" id="postgresStatus">PostgreSQL: Checking...</div>
            <div class="db-status" id="mongoStatus">MongoDB: Checking...</div>
            <div class="db-status" id="redisStatus">Redis: Checking...</div>
            <div class="db-status" id="neo4jStatus">Neo4j: Checking...</div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('status')">üìä Project Status</button>
            <button class="nav-tab" onclick="switchTab('queries')">üîç Database Queries</button>
        </div>

        <!-- Project Status Tab -->
        <div id="statusTab" class="tab-content active">
            <div class="project-selector">
                <select id="projectSelect" onchange="loadProjectData()">
                    <option value="">Select a project...</option>
                </select>
                <button class="refresh-btn" onclick="loadProjects()">üîÑ Refresh</button>
            </div>

            <div class="status-grid">
                <div class="status-item">
                    <span class="status-value" id="projectFiles">-</span>
                    <div class="status-label">Project Files</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="analysisCount">-</span>
                    <div class="status-label">Analyses</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="semanticNodes">-</span>
                    <div class="status-label">Semantic Nodes</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="lastAnalysis">-</span>
                    <div class="status-label">Last Analysis</div>
                </div>
            </div>

            <div class="card">
                <h3>üìÅ Project Information</h3>
                <div id="projectInfo" class="results-container">Select a project to view information</div>
            </div>
        </div>

        <!-- Database Queries Tab -->
        <div id="queriesTab" class="tab-content">
            <div class="card">
                <h3>üìä PostgreSQL Queries</h3>
                <div class="query-buttons">
                    <button class="query-btn" onclick="runQuery('pg-projects')">All Projects</button>
                    <button class="query-btn" onclick="runQuery('pg-recent-analyses')">Recent Analyses</button>
                    <button class="query-btn" onclick="runQuery('pg-project-stats')">Project Statistics</button>
                    <button class="query-btn" onclick="runQuery('pg-tool-usage')">Tool Usage</button>
                </div>
                <div id="pgResults" class="results-container">Click a button to run a query</div>
            </div>

            <div class="card">
                <h3>üçÉ MongoDB Queries</h3>
                <div class="query-buttons">
                    <button class="query-btn" onclick="runQuery('mongo-intelligence')">Project Intelligence</button>
                    <button class="query-btn" onclick="runQuery('mongo-analysis-results')">Analysis Results</button>
                    <button class="query-btn" onclick="runQuery('mongo-tool-configs')">Tool Configurations</button>
                    <button class="query-btn" onclick="runQuery('mongo-knowledge')">Knowledge Repository</button>
                </div>
                <div id="mongoResults" class="results-container">Click a button to run a query</div>
            </div>

            <div class="card">
                <h3>üîç Semantic Search</h3>
                <div class="query-buttons">
                    <button class="query-btn" onclick="runSemanticSearch('class definitions')">Find Classes</button>
                    <button class="query-btn" onclick="runSemanticSearch('function implementations')">Find Functions</button>
                    <button class="query-btn" onclick="runSemanticSearch('database models')">Find Models</button>
                    <button class="query-btn" onclick="runSemanticSearch('api endpoints')">Find APIs</button>
                </div>
                <div id="semanticResults" class="results-container">Click a button to search</div>
            </div>

            <div class="card">
                <h3>üï∏Ô∏è Neo4j Graph Queries</h3>
                <div class="query-buttons">
                    <button class="query-btn" onclick="runQuery('neo4j-nodes')">All Nodes</button>
                    <button class="query-btn" onclick="runQuery('neo4j-relationships')">Relationships</button>
                    <button class="query-btn" onclick="runQuery('neo4j-dependencies')">Dependencies</button>
                    <button class="query-btn" onclick="runQuery('neo4j-patterns')">Code Patterns</button>
                </div>
                <div id="neo4jResults" class="results-container">Click a button to run a query</div>
            </div>
        </div>
    </div>

    <script>
        let currentProject = null;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            checkConnections();
            loadProjects();
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Check database connections
        async function checkConnections() {
            const databases = ['postgres', 'mongo', 'redis', 'neo4j'];
            
            for (const db of databases) {
                try {
                    const response = await fetch(`/api/health/${db}`);
                    const status = await response.json();
                    
                    const element = document.getElementById(db + 'Status');
                    if (status.connected) {
                        element.textContent = `${db.charAt(0).toUpperCase() + db.slice(1)}: Connected`;
                        element.className = 'db-status connected';
                    } else {
                        element.textContent = `${db.charAt(0).toUpperCase() + db.slice(1)}: Disconnected`;
                        element.className = 'db-status disconnected';
                    }
                } catch (error) {
                    const element = document.getElementById(db + 'Status');
                    element.textContent = `${db.charAt(0).toUpperCase() + db.slice(1)}: Error`;
                    element.className = 'db-status disconnected';
                }
            }
        }

        // Load projects list
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();
                
                const select = document.getElementById('projectSelect');
                select.innerHTML = '<option value="">Select a project...</option>';
                
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = `${project.project_name} (${project.project_path})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load projects:', error);
                showError('Failed to load projects');
            }
        }

        // Load project data
        async function loadProjectData() {
            const projectId = document.getElementById('projectSelect').value;
            if (!projectId) return;
            
            currentProject = projectId;
            
            try {
                // Load project info
                const response = await fetch(`/api/project/${projectId}`);
                const data = await response.json();
                
                // Update status metrics
                document.getElementById('projectFiles').textContent = data.fileCount || '-';
                document.getElementById('analysisCount').textContent = data.analysisCount || '-';
                document.getElementById('semanticNodes').textContent = data.semanticNodes || '-';
                document.getElementById('lastAnalysis').textContent = data.lastAnalysis || '-';
                
                // Update project info
                document.getElementById('projectInfo').textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                console.error('Failed to load project data:', error);
                showError('Failed to load project data');
            }
        }

        // Run database queries
        async function runQuery(queryType) {
            const resultContainers = {
                'pg-projects': 'pgResults',
                'pg-recent-analyses': 'pgResults',
                'pg-project-stats': 'pgResults',
                'pg-tool-usage': 'pgResults',
                'mongo-intelligence': 'mongoResults',
                'mongo-analysis-results': 'mongoResults',
                'mongo-tool-configs': 'mongoResults',
                'mongo-knowledge': 'mongoResults',
                'neo4j-nodes': 'neo4jResults',
                'neo4j-relationships': 'neo4jResults',
                'neo4j-dependencies': 'neo4jResults',
                'neo4j-patterns': 'neo4jResults'
            };
            
            const container = document.getElementById(resultContainers[queryType]);
            container.innerHTML = '<div class="loading">Running query...</div>';
            
            try {
                const response = await fetch('/api/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        type: queryType,
                        projectId: currentProject 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    container.textContent = JSON.stringify(result.data, null, 2);
                } else {
                    container.innerHTML = `<div class="error">Error: ${result.error}</div>`;
                }
                
            } catch (error) {
                container.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
            }
        }

        // Run semantic search
        async function runSemanticSearch(searchTerm) {
            const container = document.getElementById('semanticResults');
            container.innerHTML = '<div class="loading">Searching...</div>';
            
            try {
                const response = await fetch('/api/semantic-search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        query: searchTerm,
                        projectId: currentProject 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    container.textContent = JSON.stringify(result.results, null, 2);
                } else {
                    container.innerHTML = `<div class="error">Error: ${result.error}</div>`;
                }
                
            } catch (error) {
                container.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
            }
        }

        // Utility functions
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>