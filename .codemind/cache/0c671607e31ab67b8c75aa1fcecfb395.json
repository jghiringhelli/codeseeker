{
  "content": "#!/usr/bin/env node\r\n\r\n/**\r\n * Project Registration and Data Population Helper\r\n * Handles registering projects and populating with sample data\r\n */\r\n\r\nconst { Pool } = require('pg');\r\nconst path = require('path');\r\nconst fs = require('fs').promises;\r\nconst { v4: uuidv4 } = require('uuid');\r\nconst chalk = require('chalk');\r\n\r\n// PostgreSQL configuration\r\nconst config = {\r\n  postgres: {\r\n    host: process.env.DB_HOST || 'localhost',\r\n    port: process.env.DB_PORT || 5432,\r\n    database: process.env.DB_NAME || 'codemind',\r\n    user: process.env.DB_USER || 'codemind',\r\n    password: process.env.DB_PASSWORD || 'codemind123'\r\n  }\r\n};\r\n\r\nasync function initializeProjectData({ projectPath, projectName, resetProject = false, projectStats = {} }) {\r\n  const pgClient = new Pool(config.postgres);\r\n  \r\n  try {\r\n    // Check if project already exists\r\n    const existingQuery = 'SELECT id FROM projects WHERE project_path = $1 LIMIT 1';\r\n    const existingResult = await pgClient.query(existingQuery, [projectPath]);\r\n    \r\n    let projectId;\r\n    \r\n    if (existingResult.rows.length > 0 && !resetProject) {\r\n      projectId = existingResult.rows[0].id;\r\n      console.log(chalk.yellow(`ðŸ“ Using existing project: ${projectId}`));\r\n    } else {\r\n      if (existingResult.rows.length > 0 && resetProject) {\r\n        projectId = existingResult.rows[0].id;\r\n        console.log(chalk.blue('ðŸ”„ Resetting project data...'));\r\n        \r\n        // Clean up all tool data for this project\r\n        await cleanupProjectData(pgClient, projectId);\r\n      } else {\r\n        // Create new project\r\n        projectId = uuidv4();\r\n        console.log(chalk.blue('ðŸ“ Creating new project...'));\r\n        \r\n        const insertQuery = `\r\n          INSERT INTO projects (\r\n            id, project_path, project_name, project_type, \r\n            languages, frameworks, project_size, total_files, status\r\n          ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\r\n        `;\r\n        \r\n        await pgClient.query(insertQuery, [\r\n          projectId,\r\n          projectPath,\r\n          projectName,\r\n          'api_service',\r\n          JSON.stringify(['TypeScript', 'JavaScript']),\r\n          JSON.stringify(['Node.js', 'Express']),\r\n          projectStats.projectSize || 'medium',\r\n          projectStats.totalFiles || 0,\r\n          'active'\r\n        ]);\r\n      }\r\n      \r\n      // Populate with comprehensive sample data\r\n      await populateProjectData(pgClient, projectId, projectPath, projectName);\r\n    }\r\n    \r\n    return { \r\n      success: true, \r\n      projectId,\r\n      isNew: existingResult.rows.length === 0,\r\n      wasReset: resetProject && existingResult.rows.length > 0\r\n    };\r\n    \r\n  } finally {\r\n    await pgClient.end();\r\n  }\r\n}\r\n\r\nasync function cleanupProjectData(pgClient, projectId) {\r\n  const cleanupQueries = [\r\n    'DELETE FROM code_duplications WHERE project_id = $1',\r\n    'DELETE FROM centralization_opportunities WHERE project_id = $1',\r\n    'DELETE FROM test_coverage_data WHERE project_id = $1',\r\n    'DELETE FROM compilation_results WHERE project_id = $1',\r\n    'DELETE FROM compilation_issues WHERE project_id = $1',\r\n    'DELETE FROM solid_violations WHERE project_id = $1',\r\n    'DELETE FROM ui_components WHERE project_id = $1',\r\n    'DELETE FROM ui_navigation_flows WHERE project_id = $1',\r\n    'DELETE FROM code_embeddings_text WHERE project_id = $1',\r\n    'DELETE FROM documentation_structure WHERE project_id = $1',\r\n    'DELETE FROM use_cases WHERE project_id = $1',\r\n    'DELETE FROM detected_patterns WHERE project_id = $1',\r\n    'DELETE FROM analysis_results WHERE project_id = $1'\r\n  ];\r\n  \r\n  for (const query of cleanupQueries) {\r\n    try {\r\n      await pgClient.query(query, [projectId]);\r\n    } catch (error) {\r\n      // Continue if table doesn't exist\r\n      if (!error.message.includes('does not exist')) {\r\n        console.warn(chalk.yellow(`Warning cleaning ${query}: ${error.message}`));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function populateProjectData(pgClient, projectId, projectPath, projectName) {\r\n  console.log(chalk.blue('ðŸ“Š Populating project with sample data...'));\r\n  \r\n  // Tree Navigation Data removed - using semantic graph instead\r\n  console.log(chalk.blue('ðŸ”— Tree navigation data consolidated into semantic graph'));\r\n  \r\n  // Code Duplications\r\n  await pgClient.query(`\r\n    INSERT INTO code_duplications (project_id, duplication_type, similarity_score, source_file, source_start_line, source_end_line, target_file, target_start_line, target_end_line, code_snippet, tokens_count, refactor_suggestion, priority, status) VALUES\r\n    ($1, 'exact', 1.00, '/src/cli/codemind.ts', 45, 52, '/src/cli/enhanced.ts', 67, 74, 'const logger = Logger.getInstance();', 25, 'Extract to shared logger utility', 'medium', 'detected'),\r\n    ($1, 'similar', 0.85, '/src/features/database.ts', 120, 145, '/src/features/analyzer.ts', 200, 225, 'Schema extraction logic', 150, 'Create shared schema extraction service', 'high', 'detected'),\r\n    ($1, 'structural', 0.75, '/src/dashboard/server.js', 500, 550, '/src/orchestration/server.ts', 300, 350, 'Express route setup pattern', 200, 'Use route factory pattern', 'low', 'detected')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Centralization Opportunities\r\n  await pgClient.query(`\r\n    INSERT INTO centralization_opportunities (project_id, opportunity_type, pattern_name, occurrences, affected_files, centralization_benefit, suggested_location, suggested_approach, complexity_reduction, priority, status) VALUES\r\n    ($1, 'scattered_logic', 'Database Connection', 5, '{\"/src/dashboard/server.js\", \"/src/orchestration/server.ts\", \"/src/features/database.ts\"}', 'Single connection pool management', '/src/shared/database-connection.ts', 'Create DatabaseConnectionManager singleton', 0.70, 'high', 'identified'),\r\n    ($1, 'repeated_pattern', 'Error Handling', 8, '{\"/src/cli/codemind.ts\", \"/src/dashboard/server.js\"}', 'Consistent error handling', '/src/shared/error-handler.ts', 'Implement centralized error handler with custom error classes', 0.65, 'medium', 'identified'),\r\n    ($1, 'cross_cutting_concern', 'Logging', 12, '{\"/src/cli/*.ts\", \"/src/features/**/*.ts\"}', 'Unified logging strategy', '/src/utils/logger.ts', 'Enhance existing Logger with log levels and transports', 0.80, 'high', 'identified')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Test Coverage Data\r\n  await pgClient.query(`\r\n    INSERT INTO test_coverage_data (project_id, file_path, coverage_type, total_items, covered_items, coverage_percentage, uncovered_lines, test_files, complexity_score, risk_level, last_test_run) VALUES\r\n    ($1, '/src/cli/codemind.ts', 'line', 684, 342, 50.00, '{125,126,127,245,246,247}', '{\"/tests/cli/codemind.test.ts\"}', 85, 'high', NOW()),\r\n    ($1, '/src/features/database.ts', 'line', 450, 315, 70.00, '{100,101,102,200,201,202}', '{\"/tests/features/database.test.ts\"}', 92, 'medium', NOW()),\r\n    ($1, '/src/dashboard/server.js', 'line', 3200, 1600, 50.00, '{1500,1501,1502}', '{\"/tests/dashboard/server.test.js\"}', 78, 'high', NOW())\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Compilation Results\r\n  const buildId = `build-${Date.now()}`;\r\n  await pgClient.query(`\r\n    INSERT INTO compilation_results (project_id, build_id, build_status, compiler, total_files, successful_files, files_with_errors, files_with_warnings, build_time_ms, output_size_bytes, errors, warnings) VALUES\r\n    ($1, $2, 'warning', 'tsc', 109, 105, 2, 4, 5432, 2485760, \r\n    '[{\"file\": \"/src/cli/codemind.ts\", \"line\": 45, \"message\": \"Type error TS2322\"}]'::jsonb,\r\n    '[{\"file\": \"/src/dashboard/server.js\", \"line\": 100, \"message\": \"Unused variable\"}]'::jsonb)\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId, buildId]);\r\n  \r\n  await pgClient.query(`\r\n    INSERT INTO compilation_issues (project_id, build_id, file_path, line_number, column_number, issue_type, severity, message, suggestion) VALUES\r\n    ($1, $2, '/src/cli/codemind.ts', 45, 12, 'type', 'error', 'Type string is not assignable to type number', 'Check variable type declaration'),\r\n    ($1, $2, '/src/dashboard/server.js', 100, 15, 'other', 'warning', 'Unused variable config', 'Remove unused variable')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId, buildId]);\r\n  \r\n  // SOLID Violations\r\n  await pgClient.query(`\r\n    INSERT INTO solid_violations (project_id, file_path, class_name, principle, violation_type, description, line_number, severity, refactoring_suggestion, estimated_effort, status) VALUES\r\n    ($1, '/src/dashboard/server.js', 'DashboardServer', 'SRP', 'Multiple Responsibilities', 'Class handles HTTP server, database operations, and business logic', 50, 'major', 'Split into DashboardServer, DatabaseService, and BusinessLogicService', 'large', 'detected'),\r\n    ($1, '/src/cli/codemind.ts', 'CodeMindCLI', 'OCP', 'Direct Modification', 'Adding new tools requires modifying the class', 180, 'moderate', 'Use plugin architecture with tool registration', 'medium', 'detected')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // UI Components\r\n  await pgClient.query(`\r\n    INSERT INTO ui_components (project_id, component_name, component_type, file_path, parent_component, children_components, props, state_management, routes, dependencies, complexity_score, accessibility_score, performance_score) VALUES\r\n    ($1, 'DashboardLayout', 'layout', '/src/dashboard/index.html', NULL, '{ProjectView,Settings,Metrics}', '{\"theme\": \"dark\", \"sidebarCollapsed\": false}'::jsonb, '{\"provider\": \"context\"}'::jsonb, '{\"/\", \"/projects\", \"/settings\"}', '{Header,Sidebar,Footer}', 45, 0.85, 0.90),\r\n    ($1, 'ProjectView', 'page', '/src/dashboard/project-view.html', 'DashboardLayout', '{TreeView,MetricsPanel,ToolsPanel}', '{\"projectId\": \"string\"}'::jsonb, '{\"state\": \"local\"}'::jsonb, '{\"/projects/:id\"}', '{TreeView,MetricsPanel}', 68, 0.75, 0.85),\r\n    ($1, 'TreeView', 'widget', '/src/dashboard/components/tree-view.js', 'ProjectView', '{}', '{\"data\": \"array\", \"onSelect\": \"function\"}'::jsonb, '{}'::jsonb, '{}', '{}', 35, 0.90, 0.95)\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Use Cases\r\n  await pgClient.query(`\r\n    INSERT INTO use_cases (project_id, use_case_name, category, description, actors, preconditions, postconditions, main_flow, alternate_flows, related_files, test_coverage, implementation_status, priority) VALUES\r\n    ($1, 'Analyze Project Codebase', 'feature', 'User analyzes a project to understand its structure and quality', '{developer,architect}', '{\"Project exists\", \"User has access\"}', '{\"Analysis complete\", \"Results displayed\"}', '[{\"step\": 1, \"action\": \"Select project\"}, {\"step\": 2, \"action\": \"Run analysis\"}, {\"step\": 3, \"action\": \"View results\"}]'::jsonb, '[]'::jsonb, '{\"/src/cli/codemind.ts\", \"/src/dashboard/project-view.html\"}', true, 'implemented', 'high'),\r\n    ($1, 'Configure Tool Settings', 'requirement', 'User configures tool behavior and preferences', '{developer}', '{\"User logged in\"}', '{\"Settings saved\"}', '[{\"step\": 1, \"action\": \"Open settings\"}, {\"step\": 2, \"action\": \"Modify values\"}, {\"step\": 3, \"action\": \"Save\"}]'::jsonb, '[{\"condition\": \"Invalid settings\", \"action\": \"Show error\"}]'::jsonb, '{\"/src/dashboard/settings.js\"}', false, 'in_progress', 'medium')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Detected Patterns\r\n  await pgClient.query(`\r\n    INSERT INTO detected_patterns (project_id, pattern_type, pattern_name, confidence_score, evidence, status) VALUES \r\n    ($1, 'architecture', 'Layered Architecture', 0.90, '{}'::jsonb, 'detected'),\r\n    ($1, 'design_pattern', 'Singleton', 0.85, '{\"files\": [\"/src/utils/logger.ts\"]}'::jsonb, 'detected'),\r\n    ($1, 'design_pattern', 'Factory', 0.75, '{\"files\": [\"/src/cli/tool-factory.ts\"]}'::jsonb, 'detected'),\r\n    ($1, 'coding_standard', 'ESLint Compliance', 0.95, '{}'::jsonb, 'validated'),\r\n    ($1, 'testing_pattern', 'Unit Testing', 0.70, '{\"coverage\": 50}'::jsonb, 'detected')\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  // Analysis Results\r\n  await pgClient.query(`\r\n    INSERT INTO analysis_results (project_id, file_path, file_hash, analysis_type, analysis_result, confidence_score) VALUES\r\n    ($1, '/src/cli/codemind.ts', 'abc123def456', 'quality', '{\"complexity\": 85, \"maintainability\": 65, \"readability\": 70}'::jsonb, 0.88),\r\n    ($1, '/src/dashboard/server.js', 'ghi789jkl012', 'architecture', '{\"layer\": \"presentation\", \"dependencies\": 20}'::jsonb, 0.92),\r\n    ($1, '/src/features/database.ts', 'mno345pqr678', 'dependency', '{\"imports\": 8, \"exports\": 3, \"circular\": false}'::jsonb, 0.95)\r\n    ON CONFLICT DO NOTHING\r\n  `, [projectId]);\r\n  \r\n  console.log(chalk.green('âœ… Project data populated successfully'));\r\n}\r\n\r\nmodule.exports = {\r\n  initializeProjectData,\r\n  cleanupProjectData,\r\n  populateProjectData\r\n};",
  "hash": "b8e90ce454f6a52fc21bd5361b2de1fad3a6f7375e3be99a01a061453beb92af",
  "lastModified": 1757977735795,
  "language": "JavaScript",
  "exports": [],
  "imports": [],
  "functions": [
    "const",
    "const",
    "const",
    "const",
    "function",
    "const",
    "const",
    "const",
    "const",
    "function",
    "const",
    "function",
    "const",
    "const"
  ],
  "classes": []
}