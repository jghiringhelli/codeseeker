{
  "content": "// MongoDB Initialization Script for CodeMind\r\n// Creates database, collections, indexes, and initial data\r\n\r\n// Switch to the codemind database\r\ndb = db.getSiblingDB('codemind');\r\n\r\n// Create collections with validation schemas\r\nprint('Creating MongoDB collections...');\r\n\r\n// 1. Tool Configurations Collection\r\ndb.createCollection('tool_configs', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['projectId', 'toolName', 'config', 'updatedAt'],\r\n      properties: {\r\n        projectId: {\r\n          bsonType: 'string',\r\n          description: 'Project UUID'\r\n        },\r\n        toolName: {\r\n          bsonType: 'string',\r\n          description: 'Tool identifier'\r\n        },\r\n        config: {\r\n          bsonType: 'object',\r\n          description: 'Tool configuration object'\r\n        },\r\n        version: {\r\n          bsonType: 'string',\r\n          description: 'Configuration version'\r\n        },\r\n        updatedAt: {\r\n          bsonType: 'date',\r\n          description: 'Last update timestamp'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 2. Analysis Results Collection\r\ndb.createCollection('analysis_results', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['projectId', 'toolName', 'timestamp', 'analysis'],\r\n      properties: {\r\n        projectId: {\r\n          bsonType: 'string',\r\n          description: 'Project UUID'\r\n        },\r\n        toolName: {\r\n          bsonType: 'string',\r\n          description: 'Tool that generated the analysis'\r\n        },\r\n        timestamp: {\r\n          bsonType: 'date',\r\n          description: 'Analysis timestamp'\r\n        },\r\n        analysis: {\r\n          bsonType: 'object',\r\n          description: 'Analysis data'\r\n        },\r\n        summary: {\r\n          bsonType: 'string',\r\n          description: 'Analysis summary for search'\r\n        },\r\n        fileCount: {\r\n          bsonType: 'int',\r\n          description: 'Number of files analyzed'\r\n        },\r\n        hasIssues: {\r\n          bsonType: 'bool',\r\n          description: 'Whether issues were found'\r\n        },\r\n        tags: {\r\n          bsonType: 'array',\r\n          description: 'Searchable tags'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 3. Project Intelligence Collection\r\ndb.createCollection('project_intelligence', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['projectId', 'context', 'lastUpdated'],\r\n      properties: {\r\n        projectId: {\r\n          bsonType: 'string',\r\n          description: 'Project UUID'\r\n        },\r\n        context: {\r\n          bsonType: 'object',\r\n          required: ['languages', 'frameworks', 'projectType'],\r\n          properties: {\r\n            languages: {\r\n              bsonType: 'array',\r\n              description: 'Programming languages used'\r\n            },\r\n            frameworks: {\r\n              bsonType: 'array',\r\n              description: 'Frameworks detected'\r\n            },\r\n            projectType: {\r\n              bsonType: 'string',\r\n              description: 'Type of project'\r\n            },\r\n            fileStructure: {\r\n              bsonType: 'object',\r\n              description: 'Project file structure'\r\n            },\r\n            patterns: {\r\n              bsonType: 'object',\r\n              description: 'Detected patterns'\r\n            },\r\n            complexity: {\r\n              enum: ['low', 'medium', 'high'],\r\n              description: 'Project complexity'\r\n            },\r\n            recommendedTools: {\r\n              bsonType: 'array',\r\n              description: 'Recommended tools for this project'\r\n            }\r\n          }\r\n        },\r\n        lastUpdated: {\r\n          bsonType: 'date',\r\n          description: 'Last update timestamp'\r\n        },\r\n        version: {\r\n          bsonType: 'int',\r\n          description: 'Context version'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 4. Knowledge Repository Collection\r\ndb.createCollection('knowledge_repository', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['projectId', 'type', 'title', 'content', 'createdAt'],\r\n      properties: {\r\n        projectId: {\r\n          bsonType: 'string',\r\n          description: 'Project UUID'\r\n        },\r\n        type: {\r\n          enum: ['readme', 'documentation', 'comment', 'guide', 'api', 'tutorial'],\r\n          description: 'Document type'\r\n        },\r\n        title: {\r\n          bsonType: 'string',\r\n          description: 'Document title'\r\n        },\r\n        content: {\r\n          bsonType: 'string',\r\n          description: 'Document content'\r\n        },\r\n        metadata: {\r\n          bsonType: 'object',\r\n          description: 'Additional metadata'\r\n        },\r\n        searchableText: {\r\n          bsonType: 'string',\r\n          description: 'Plain text for full-text search'\r\n        },\r\n        relatedFiles: {\r\n          bsonType: 'array',\r\n          description: 'Related file paths'\r\n        },\r\n        tags: {\r\n          bsonType: 'array',\r\n          description: 'Document tags'\r\n        },\r\n        createdAt: {\r\n          bsonType: 'date',\r\n          description: 'Creation timestamp'\r\n        },\r\n        updatedAt: {\r\n          bsonType: 'date',\r\n          description: 'Last update timestamp'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 5. Workflow States Collection (for complex workflow tracking)\r\ndb.createCollection('workflow_states', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['workflowId', 'projectId', 'status', 'currentStep'],\r\n      properties: {\r\n        workflowId: {\r\n          bsonType: 'string',\r\n          description: 'Workflow execution ID'\r\n        },\r\n        projectId: {\r\n          bsonType: 'string',\r\n          description: 'Project UUID'\r\n        },\r\n        status: {\r\n          enum: ['pending', 'running', 'completed', 'failed', 'paused'],\r\n          description: 'Workflow status'\r\n        },\r\n        currentStep: {\r\n          bsonType: 'int',\r\n          description: 'Current step number'\r\n        },\r\n        steps: {\r\n          bsonType: 'array',\r\n          description: 'Workflow steps with status and output'\r\n        },\r\n        dynamicContext: {\r\n          bsonType: 'object',\r\n          description: 'Dynamic workflow context'\r\n        },\r\n        startTime: {\r\n          bsonType: 'date',\r\n          description: 'Workflow start time'\r\n        },\r\n        endTime: {\r\n          bsonType: 'date',\r\n          description: 'Workflow end time'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 6. Templates Collection (for code generation)\r\ndb.createCollection('templates', {\r\n  validator: {\r\n    $jsonSchema: {\r\n      bsonType: 'object',\r\n      required: ['name', 'category', 'template'],\r\n      properties: {\r\n        name: {\r\n          bsonType: 'string',\r\n          description: 'Template name'\r\n        },\r\n        category: {\r\n          bsonType: 'string',\r\n          description: 'Template category'\r\n        },\r\n        framework: {\r\n          bsonType: 'string',\r\n          description: 'Target framework'\r\n        },\r\n        language: {\r\n          bsonType: 'string',\r\n          description: 'Programming language'\r\n        },\r\n        template: {\r\n          bsonType: 'object',\r\n          description: 'Template definition'\r\n        },\r\n        variables: {\r\n          bsonType: 'array',\r\n          description: 'Template variables'\r\n        },\r\n        tags: {\r\n          bsonType: 'array',\r\n          description: 'Template tags'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nprint('Collections created successfully');\r\n\r\n// Create indexes for optimal query performance\r\nprint('Creating indexes...');\r\n\r\n// Tool Configs indexes\r\ndb.tool_configs.createIndex({ projectId: 1, toolName: 1 }, { unique: true });\r\ndb.tool_configs.createIndex({ 'config.frameworks': 1 });\r\ndb.tool_configs.createIndex({ updatedAt: -1 });\r\n\r\n// Analysis Results indexes\r\ndb.analysis_results.createIndex({ projectId: 1, toolName: 1, timestamp: -1 });\r\ndb.analysis_results.createIndex({ projectId: 1, hasIssues: 1 });\r\ndb.analysis_results.createIndex({ tags: 1 });\r\ndb.analysis_results.createIndex({ summary: 'text' }); // Full-text search\r\n\r\n// Project Intelligence indexes\r\ndb.project_intelligence.createIndex({ projectId: 1 }, { unique: true });\r\ndb.project_intelligence.createIndex({ 'context.languages': 1 });\r\ndb.project_intelligence.createIndex({ 'context.frameworks': 1 });\r\ndb.project_intelligence.createIndex({ 'context.projectType': 1 });\r\ndb.project_intelligence.createIndex({ 'context.complexity': 1 });\r\n\r\n// Knowledge Repository indexes\r\ndb.knowledge_repository.createIndex({ projectId: 1, type: 1 });\r\ndb.knowledge_repository.createIndex({ tags: 1 });\r\ndb.knowledge_repository.createIndex({ relatedFiles: 1 });\r\ndb.knowledge_repository.createIndex({ \r\n  title: 'text', \r\n  content: 'text', \r\n  searchableText: 'text' \r\n}, { \r\n  weights: { \r\n    title: 10, \r\n    searchableText: 5, \r\n    content: 1 \r\n  } \r\n});\r\n\r\n// Workflow States indexes\r\ndb.workflow_states.createIndex({ workflowId: 1 }, { unique: true });\r\ndb.workflow_states.createIndex({ projectId: 1, status: 1 });\r\ndb.workflow_states.createIndex({ startTime: -1 });\r\n\r\n// Templates indexes\r\ndb.templates.createIndex({ name: 1, category: 1 }, { unique: true });\r\ndb.templates.createIndex({ framework: 1, language: 1 });\r\ndb.templates.createIndex({ tags: 1 });\r\n\r\nprint('Indexes created successfully');\r\n\r\n// Create TTL indexes for automatic cleanup\r\nprint('Creating TTL indexes for data retention...');\r\n\r\n// Remove analysis results older than 90 days\r\ndb.analysis_results.createIndex(\r\n  { timestamp: 1 },\r\n  { expireAfterSeconds: 7776000 } // 90 days\r\n);\r\n\r\n// Remove completed workflows older than 30 days\r\ndb.workflow_states.createIndex(\r\n  { endTime: 1 },\r\n  { \r\n    expireAfterSeconds: 2592000, // 30 days\r\n    partialFilterExpression: { status: 'completed' }\r\n  }\r\n);\r\n\r\nprint('TTL indexes created successfully');\r\n\r\n// Insert foundation data (tool configuration templates)\r\nprint('Inserting foundation data...');\r\n\r\n// Default tool configuration templates\r\ndb.tool_configs.insertMany([\r\n  {\r\n    projectId: 'default',\r\n    toolName: 'semantic-search',\r\n    config: {\r\n      embeddingModel: 'text-embedding-ada-002',\r\n      chunkSize: 4000,\r\n      overlapSize: 200,\r\n      similarity: 'cosine',\r\n      cacheEnabled: true,\r\n      batchSize: 10\r\n    },\r\n    version: '1.0.0',\r\n    updatedAt: new Date()\r\n  },\r\n  {\r\n    projectId: 'default',\r\n    toolName: 'solid-principles',\r\n    config: {\r\n      checkSRP: true,\r\n      checkOCP: true,\r\n      checkLSP: true,\r\n      checkISP: true,\r\n      checkDIP: true,\r\n      severityThreshold: 'medium',\r\n      maxClassComplexity: 10,\r\n      maxMethodLength: 50\r\n    },\r\n    version: '1.0.0',\r\n    updatedAt: new Date()\r\n  },\r\n  {\r\n    projectId: 'default',\r\n    toolName: 'compilation-verifier',\r\n    config: {\r\n      typescript: {\r\n        strict: true,\r\n        noImplicitAny: true,\r\n        strictNullChecks: true\r\n      },\r\n      javascript: {\r\n        useESLint: true,\r\n        ecmaVersion: 2022\r\n      },\r\n      timeout: 30000\r\n    },\r\n    version: '1.0.0',\r\n    updatedAt: new Date()\r\n  }\r\n]);\r\n\r\n// Insert template configurations for common project types\r\ndb.project_intelligence.insertMany([\r\n  {\r\n    projectId: 'template-react',\r\n    context: {\r\n      languages: ['typescript', 'javascript'],\r\n      frameworks: ['react'],\r\n      projectType: 'web_application',\r\n      fileStructure: {\r\n        entryPoints: ['src/index.tsx', 'src/App.tsx'],\r\n        configFiles: ['package.json', 'tsconfig.json', 'webpack.config.js'],\r\n        testDirectories: ['src/__tests__', 'src/**/*.test.tsx']\r\n      },\r\n      patterns: {\r\n        architectural: ['Component-Based', 'Flux/Redux'],\r\n        design: ['Observer', 'Factory', 'Singleton']\r\n      },\r\n      complexity: 'medium',\r\n      recommendedTools: [\r\n        'semantic-search',\r\n        'solid-principles',\r\n        'compilation-verifier',\r\n        'ui-navigation',\r\n        'tree-navigation'\r\n      ]\r\n    },\r\n    lastUpdated: new Date(),\r\n    version: 1\r\n  },\r\n  {\r\n    projectId: 'template-nodejs',\r\n    context: {\r\n      languages: ['javascript', 'typescript'],\r\n      frameworks: ['express', 'nodejs'],\r\n      projectType: 'api_service',\r\n      fileStructure: {\r\n        entryPoints: ['src/index.js', 'app.js', 'server.js'],\r\n        configFiles: ['package.json', 'tsconfig.json', '.env'],\r\n        testDirectories: ['test', 'tests', '__tests__']\r\n      },\r\n      patterns: {\r\n        architectural: ['MVC', 'REST', 'Microservices'],\r\n        design: ['Repository', 'Factory', 'Dependency Injection']\r\n      },\r\n      complexity: 'medium',\r\n      recommendedTools: [\r\n        'semantic-search',\r\n        'solid-principles',\r\n        'compilation-verifier',\r\n        'use-cases'\r\n      ]\r\n    },\r\n    lastUpdated: new Date(),\r\n    version: 1\r\n  }\r\n]);\r\n\r\nprint('Foundation data inserted successfully');\r\n\r\n// Create a user for application access (if not in Docker)\r\ntry {\r\n  db.createUser({\r\n    user: 'codemind_app',\r\n    pwd: 'codemind123',\r\n    roles: [\r\n      { role: 'readWrite', db: 'codemind' }\r\n    ]\r\n  });\r\n  print('Application user created');\r\n} catch (e) {\r\n  print('User already exists or running in Docker environment');\r\n}\r\n\r\nprint('MongoDB initialization completed successfully!');",
  "hash": "7526dcdb664c4bbfdc54a15c70aa0738638eecd7d54dd4a0261fcf4d38198669",
  "lastModified": 1758036122389,
  "language": "JavaScript",
  "exports": [],
  "imports": [],
  "functions": [],
  "classes": []
}