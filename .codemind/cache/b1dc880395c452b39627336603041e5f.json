{
  "content": "#!/usr/bin/env node\n\n/**\n * Dashboard Data Validation Helper\n * Validates that dashboard has sufficient data to display meaningful information\n */\n\nconst { Pool } = require('pg');\nconst chalk = require('chalk');\n\n// PostgreSQL configuration\nconst config = {\n  postgres: {\n    host: process.env.DB_HOST || 'localhost',\n    port: process.env.DB_PORT || 5432,\n    database: process.env.DB_NAME || 'codemind',\n    user: process.env.DB_USER || 'codemind',\n    password: process.env.DB_PASSWORD || 'codemind123'\n  }\n};\n\n// Tables that should have data for a complete dashboard experience\nconst CRITICAL_TABLES = [\n  { name: 'projects', minRows: 1, description: 'Project registrations' },\n  { name: 'tree_navigation_data', minRows: 5, description: 'File tree structure' },\n  { name: 'detected_patterns', minRows: 3, description: 'Code patterns' },\n  { name: 'analysis_results', minRows: 2, description: 'Analysis results' }\n];\n\nconst OPTIONAL_TABLES = [\n  { name: 'code_duplications', minRows: 1, description: 'Code duplication issues' },\n  { name: 'centralization_opportunities', minRows: 1, description: 'Refactoring opportunities' },\n  { name: 'test_coverage_data', minRows: 1, description: 'Test coverage metrics' },\n  { name: 'compilation_results', minRows: 1, description: 'Build results' },\n  { name: 'solid_violations', minRows: 1, description: 'SOLID principle violations' },\n  { name: 'ui_components', minRows: 1, description: 'UI component analysis' },\n  { name: 'use_cases', minRows: 1, description: 'Use case documentation' }\n];\n\nasync function validateDashboardData(projectId = null) {\n  const pgClient = new Pool(config.postgres);\n  \n  const validation = {\n    isValid: false,\n    tablesWithData: 0,\n    criticalTablesMissing: 0,\n    issues: [],\n    warnings: [],\n    tableStatus: {},\n    projectSpecificData: false\n  };\n  \n  try {\n    console.log(chalk.blue('üîç Validating dashboard data...'));\n    \n    // Check critical tables\n    for (const table of CRITICAL_TABLES) {\n      const status = await checkTableData(pgClient, table, projectId);\n      validation.tableStatus[table.name] = status;\n      \n      if (status.hasData) {\n        validation.tablesWithData++;\n      } else {\n        validation.criticalTablesMissing++;\n        validation.issues.push(`Critical table '${table.name}' has insufficient data (${status.rowCount} < ${table.minRows})`);\n      }\n    }\n    \n    // Check optional tables\n    for (const table of OPTIONAL_TABLES) {\n      const status = await checkTableData(pgClient, table, projectId);\n      validation.tableStatus[table.name] = status;\n      \n      if (status.hasData) {\n        validation.tablesWithData++;\n      } else {\n        validation.warnings.push(`Optional table '${table.name}' has no data - some dashboard features may be limited`);\n      }\n    }\n    \n    // Check if we have project-specific data\n    if (projectId) {\n      const projectDataCount = await checkProjectSpecificData(pgClient, projectId);\n      validation.projectSpecificData = projectDataCount > 0;\n      validation.projectDataCount = projectDataCount;\n    }\n    \n    // Overall validation\n    validation.isValid = validation.criticalTablesMissing === 0;\n    \n    if (validation.isValid) {\n      console.log(chalk.green(`‚úÖ Dashboard validation passed: ${validation.tablesWithData} tables have data`));\n    } else {\n      console.log(chalk.yellow(`‚ö†Ô∏è  Dashboard validation issues: ${validation.criticalTablesMissing} critical tables missing data`));\n    }\n    \n    return validation;\n    \n  } catch (error) {\n    console.log(chalk.red(`‚ùå Dashboard validation failed: ${error.message}`));\n    return {\n      isValid: false,\n      error: error.message,\n      issues: [`Validation failed: ${error.message}`]\n    };\n  } finally {\n    await pgClient.end();\n  }\n}\n\nasync function checkTableData(pgClient, table, projectId) {\n  try {\n    let query = `SELECT COUNT(*) as count FROM ${table.name}`;\n    let params = [];\n    \n    // Add project filter if applicable and projectId provided\n    const projectFilterTables = [\n      'tree_navigation_data', 'code_duplications', 'centralization_opportunities',\n      'test_coverage_data', 'compilation_results', 'solid_violations',\n      'ui_components', 'use_cases', 'detected_patterns', 'analysis_results'\n    ];\n    \n    if (projectId && projectFilterTables.includes(table.name)) {\n      query += ' WHERE project_id = $1';\n      params = [projectId];\n    }\n    \n    const result = await pgClient.query(query, params);\n    const rowCount = parseInt(result.rows[0].count);\n    \n    return {\n      exists: true,\n      rowCount,\n      hasData: rowCount >= table.minRows,\n      description: table.description\n    };\n    \n  } catch (error) {\n    // Table might not exist\n    return {\n      exists: false,\n      rowCount: 0,\n      hasData: false,\n      error: error.message,\n      description: table.description\n    };\n  }\n}\n\nasync function checkProjectSpecificData(pgClient, projectId) {\n  const projectTables = [\n    'tree_navigation_data',\n    'code_duplications', \n    'centralization_opportunities',\n    'test_coverage_data',\n    'solid_violations',\n    'analysis_results'\n  ];\n  \n  let totalRecords = 0;\n  \n  for (const tableName of projectTables) {\n    try {\n      const result = await pgClient.query(`SELECT COUNT(*) as count FROM ${tableName} WHERE project_id = $1`, [projectId]);\n      totalRecords += parseInt(result.rows[0].count);\n    } catch (error) {\n      // Skip tables that don't exist\n    }\n  }\n  \n  return totalRecords;\n}\n\nasync function generateDataReport(projectId = null) {\n  const validation = await validateDashboardData(projectId);\n  \n  console.log(chalk.bold.cyan('\\nüìä DASHBOARD DATA REPORT'));\n  console.log(chalk.cyan('‚ïê'.repeat(50)));\n  \n  // Overall status\n  const status = validation.isValid ? chalk.green('‚úÖ READY') : chalk.yellow('‚ö†Ô∏è  NEEDS ATTENTION');\n  console.log(`\\nOverall Status: ${status}`);\n  console.log(`Tables with Data: ${chalk.white(validation.tablesWithData)}`);\n  \n  if (projectId) {\n    const projectStatus = validation.projectSpecificData ? chalk.green('Yes') : chalk.red('No');\n    console.log(`Project-Specific Data: ${projectStatus} (${validation.projectDataCount || 0} records)`);\n  }\n  \n  // Critical tables\n  console.log(chalk.bold.yellow('\\nüî¥ CRITICAL TABLES:'));\n  CRITICAL_TABLES.forEach(table => {\n    const status = validation.tableStatus[table.name];\n    if (status) {\n      const statusIcon = status.hasData ? chalk.green('‚úÖ') : chalk.red('‚ùå');\n      const count = status.exists ? `${status.rowCount} rows` : 'not found';\n      console.log(`   ${statusIcon} ${table.name.padEnd(25)}: ${count} - ${table.description}`);\n    }\n  });\n  \n  // Optional tables\n  console.log(chalk.bold.yellow('\\nüü° OPTIONAL TABLES:'));\n  OPTIONAL_TABLES.forEach(table => {\n    const status = validation.tableStatus[table.name];\n    if (status) {\n      const statusIcon = status.hasData ? chalk.green('‚úÖ') : chalk.gray('‚ö™');\n      const count = status.exists ? `${status.rowCount} rows` : 'not found';\n      console.log(`   ${statusIcon} ${table.name.padEnd(25)}: ${count} - ${table.description}`);\n    }\n  });\n  \n  // Issues\n  if (validation.issues.length > 0) {\n    console.log(chalk.bold.red('\\n‚ùå ISSUES:'));\n    validation.issues.forEach(issue => {\n      console.log(`   ‚Ä¢ ${issue}`);\n    });\n  }\n  \n  // Warnings\n  if (validation.warnings.length > 0) {\n    console.log(chalk.bold.yellow('\\n‚ö†Ô∏è  WARNINGS:'));\n    validation.warnings.forEach(warning => {\n      console.log(`   ‚Ä¢ ${warning}`);\n    });\n  }\n  \n  // Recommendations\n  console.log(chalk.bold.cyan('\\nüí° RECOMMENDATIONS:'));\n  if (!validation.isValid) {\n    console.log('   ‚Ä¢ Run: node scripts/init-project-master.js to populate missing data');\n    console.log('   ‚Ä¢ Ensure all databases are running and accessible');\n  }\n  if (validation.warnings.length > 0) {\n    console.log('   ‚Ä¢ Consider running comprehensive analysis to populate optional tables');\n  }\n  if (validation.isValid) {\n    console.log('   ‚Ä¢ Dashboard is ready! Start with: npm run dashboard');\n  }\n  \n  console.log(chalk.cyan('‚ïê'.repeat(50)));\n  \n  return validation;\n}\n\nmodule.exports = {\n  validateDashboardData,\n  generateDataReport,\n  checkTableData,\n  checkProjectSpecificData\n};",
  "hash": "80313dfca633a09e34480af476524e73dfe91e0d8d18aa631d045fc9726c8861",
  "lastModified": 1757339493180,
  "language": "JavaScript",
  "exports": [],
  "imports": [],
  "functions": [
    "const",
    "const",
    "const",
    "const",
    "function",
    "const",
    "const",
    "const",
    "const",
    "const",
    "function",
    "let",
    "let",
    "const",
    "const",
    "const",
    "function",
    "const",
    "let",
    "const",
    "function",
    "const",
    "const",
    "const",
    "const",
    "const",
    "const",
    "const",
    "const",
    "const"
  ],
  "classes": []
}